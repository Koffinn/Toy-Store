<div class="container my-5 fade-in">
  <header class="text-center mb-5">
    <h1 class="display-4">Naš Katalog</h1>
    <p class="lead text-muted">Sve igračke na jednom mestu</p>
  </header>

  <div class="row">
    <aside class="col-lg-3 mb-4 mb-lg-0">
      <div class="card shadow-sm position-sticky filter-card" style="top: 80px;">
        <div class="card-header bg-light"><h5 class="mb-0">Filteri i Pretraga</h5></div>
        <div class="card-body">

          <div class="mb-3">
            <label for="searchDescription" class="form-label fw-bold">Pretraga po opisu</label>
            <input type="text" id="searchDescription" class="form-control"
                   [ngModel]="igrackaService.searchDescription()"
                   (ngModelChange)="igrackaService.searchDescription.set($event)"
                   placeholder="Traži u opisu...">
          </div>
          
          <div class="mb-3">
            <label for="minPrice" class="form-label fw-bold">
              Min. cena: <span class="text-primary">{{ igrackaService.minPrice() | currency:'RSD' }}</span>
            </label>
            <input type="range" class="form-range" id="minPrice" 
                   min="0" 
                   [max]="igrackaService.maxPossiblePrice() / 2" 
                   [value]="igrackaService.minPrice()"
                   (input)="igrackaService.minPrice.set(+$any($event.target).value)">
          </div>

          <div class="mb-3">
            <label for="price-slider" class="form-label fw-bold">
              Max. cena: <span class="text-primary">{{ igrackaService.maxPrice() | currency:'RSD ' }}</span>
            </label>
            <input type="range" class="form-range" id="price-slider" 
                   min="0" 
                   [max]="igrackaService.maxPossiblePrice()" 
                   [value]="igrackaService.maxPrice()"
                   (input)="onPriceChange($event)">
          </div>

          <div class="mb-3">
            <label for="maxDate" class="form-label fw-bold">Proizvedeno do datuma:</label>
            <input type="date" id="maxDate" class="form-control"
                   [ngModel]="igrackaService.maxDate()"
                   (ngModelChange)="igrackaService.maxDate.set($event)">
          </div>
          
          <hr>
          
          <div class="mb-3">
            <label for="ageGroup" class="form-label fw-bold">Uzrast</label>
            <select id="ageGroup" class="form-select" [ngModel]="igrackaService.selectedAgeGroup()" (ngModelChange)="igrackaService.selectedAgeGroup.set(+$event)">
              <option [value]="0">Svi uzrasti</option>
              @for (uzrast of igrackaService.uzrasti(); track uzrast.ageGroupId) {
                <option [value]="uzrast.ageGroupId">{{ uzrast.name }}</option>
              }
            </select>
          </div>
          <div class="mb-3">
            <label for="toyType" class="form-label fw-bold">Tip igračke</label>
            <select id="toyType" class="form-select" [ngModel]="igrackaService.selectedType()" (ngModelChange)="igrackaService.selectedType.set(+$event)">
              <option [value]="0">Svi tipovi</option>
              @for (tip of igrackaService.tipovi(); track tip.typeId) {
                <option [value]="tip.typeId">{{ tip.name }}</option>
              }
            </select>
          </div>
          <div class="mb-3">
            <label for="targetGroup" class="form-label fw-bold">Ciljna grupa</label>
            <select id="targetGroup" class="form-select" [ngModel]="igrackaService.selectedTargetGroup()" (ngModelChange)="igrackaService.selectedTargetGroup.set($event)">
              <option value="svi">Svi</option>
              <option value="dečak">Dečaci</option>
              <option value="devojčica">Devojčice</option>
            </select>
          </div>

          <div>
            <label for="rating-filter" class="form-label fw-bold">Minimalna ocena</label>
            <select id="rating-filter" class="form-select" [ngModel]="igrackaService.minRating()" (ngModelChange)="igrackaService.minRating.set(+$event)">
              <option value="0">Sve ocene</option>
              <option value="4">4 zvezdice i više</option>
              <option value="3">3 zvezdice i više</option>
              <option value="2">2 zvezdice i više</option>
            </select>
          </div>
        </div>
      </div>
    </aside>

    <main class="col-lg-9 fade-in">
      <div class="d-flex justify-content-end mb-3">
        <select class="form-select w-auto" [ngModel]="igrackaService.sortBy()" (ngModelChange)="igrackaService.sortBy.set($event)">
          <option value="default">Sortiraj po</option>
          <option value="price-asc">Ceni (rastuće)</option>
          <option value="price-desc">Ceni (opadajuće)</option>
          <option value="date-newest">Najnovije</option>
        </select>
      </div>

      @if (igrackaService.filtriraneIgracke().length > 0) {
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
          @for (igracka of igrackaService.filtriraneIgracke(); track igracka.toyId) {
            <div class="col">
              <div class="card-clickable">
                <div class="card h-100 shadow-sm" [routerLink]="['/toy', igracka.toyId]" style="cursor: pointer;">
                  <img [src]="'https://toy.pequla.com/' + igracka.imageUrl" class="card-img-top" [alt]="igracka.name" 
                       style="height: 250px; object-fit: cover" 
                       onerror="this.onerror=null; this.src='https://placehold.co/400x300/CCCCCC/333333?text=Nema+Slike';" />
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ igracka.name }}</h5>
                    <div class="mb-2">
                      <app-star-rating [rating]="igracka.rating || 0"></app-star-rating>
                    </div>
                    <p class="card-text text-muted small">{{ igracka.description }}</p>
                    <ul class="list-group list-group-flush mt-3">
                      <li class="list-group-item"><i class="fa fa-puzzle-piece text-primary me-2"></i><strong>Tip:</strong> {{ igracka.type.name }}</li>
                      <li class="list-group-item"><i class="fa fa-child text-primary me-2"></i><strong>Uzrast:</strong> {{ igracka.ageGroup.name }}</li>
                      <li class="list-group-item"><i class="fa fa-tag text-primary me-2"></i><strong>Cena:</strong> {{ igracka.price | currency : 'RSD ' }}</li>
                    </ul>
                    <div class="mt-auto pt-3">
                      <button type="button" class="btn btn-primary w-100" 
                              (click)="$event.stopPropagation(); dodajIKorpa($event, igracka.toyId)" 
                              title="Rezerviši igračku"> 
                              <i class="fa fa-cart-plus me-2"></i>
                              Dodaj u Korpu 
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      } @else {
          <div class="no-results">
          <i class="fa fa-search"></i>
          <p>Nema igračaka koje odgovaraju zadatim kriterijumima.</p>
          </div>
      }
    </main>
  </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3 mb-5" style="z-index: 1080;">
  <div class="toast align-items-center text-bg-primary border-0 shadow-sm fade"
       id="toastKorpa"
       role="alert"
       aria-live="assertive"
       aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        <i class="fa fa-cart-plus me-2"></i>
        Igračka je dodata u korpu!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto"
              data-bs-dismiss="toast"
              aria-label="Zatvori"></button>
    </div>
  </div>
</div>
