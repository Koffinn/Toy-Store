<div class="container py-5" *ngIf="igracka; else loadingTpl">
  <!-- Sekcija detalja igračke -->
  <div class="row g-4 align-items-start">
    <div class="col-md-5">
      <div class="position-relative">
        <img [src]="'https://toy.pequla.com/' + igracka.imageUrl"
             alt="{{ igracka.name }}"
             class="img-fluid rounded shadow-sm w-100"
             style="object-fit: cover; height: 400px;"
             onerror="this.onerror=null; this.src='https://placehold.co/600x400/CCCCCC/333333?text=Nema+Slike';">
        <span class="badge bg-primary position-absolute top-0 start-0 m-2 px-3 py-2 fs-6 shadow-sm">
          {{ igracka.type.name }}
        </span>
      </div>
    </div>

    <div class="col-md-7">
      <h2 class="mb-3">{{ igracka.name }}</h2>

      <div class="d-flex align-items-center gap-3">
        <app-star-rating [rating]="igracka.rating || 0"></app-star-rating>
        <small class="text-muted">({{ recenzije.length }} recenzija)</small>
      </div>

      <p class="mt-3 text-muted">{{ igracka.description }}</p>

      <ul class="list-group mb-4 shadow-sm rounded">
        <li class="list-group-item d-flex justify-content-between">
          <span><i class="fa-solid fa-user text-primary me-2"></i>Uzrast</span>
          <strong>{{ igracka.ageGroup.name }}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span><i class="fa-solid fa-people-group text-primary me-2"></i>Ciljna grupa</span>
          <strong>{{ igracka.targetGroup }}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span><i class="fa-solid fa-calendar-days text-primary me-2"></i>Proizvedeno</span>
          <strong>{{ igracka.productionDate | date }}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span><i class="fa-solid fa-tags text-primary me-2"></i>Cena</span>
          <strong class="text-primary">{{ igracka.price | currency:'RSD ' }}</strong>
        </li>
      </ul>

      <!-- Dugme za dodavanje u korpu -->
      <button class="btn btn-outline-primary btn-lg w-100 mb-3"
              (click)="dodajUKorpu()">
        <i class="fa-solid fa-cart-plus me-2"></i> Dodaj u korpu
      </button>

      <!-- Dugme za ocenjivanje -->
      <button class="btn btn-primary btn-lg w-100"
              (click)="ratingModal.otvori()">
        <i class="fa-solid fa-star me-2"></i> Ocenite igračku
      </button>
    </div>
  </div>

  <hr class="my-5">

  <!-- Sekcija recenzija -->
  <div class="row">
    <div class="col-lg-8">
      <h4 class="mb-4 d-flex align-items-center">
        <i class="fa-solid fa-comments text-primary me-2"></i>
        Recenzije kupaca
      </h4>

      <div *ngIf="recenzije.length > 0; else noReviews">
        @for (r of recenzije; track r.komentar) {
          <div class="card mb-3 border-0 shadow-sm fade-in">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0 text-primary">
                  <i class="fa-solid fa-user-pen me-2"></i>{{ r.autor }}
                </h6>
                <app-star-rating [rating]="r.ocena"></app-star-rating>
              </div>
              <p class="mb-0 text-muted">{{ r.komentar }}</p>
            </div>
          </div>
        }
      </div>

      <ng-template #noReviews>
        <div class="alert alert-light border text-muted py-4">
          <i class="fa-solid fa-circle-info me-2"></i>
          Još uvek nema recenzija za ovu igračku.
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Modal za ocenjivanje -->
  <app-rating-modal
    #ratingModal
    [toyId]="igracka.toyId"
    (recenzijaDodata)="osveziRecenzije()">
  </app-rating-modal>

  <!-- Toast notifikacija -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3 mb-5">
    <div id="toastKorpa" class="toast text-bg-primary border-0 shadow-sm fade" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex align-items-center">
        <div class="toast-body d-flex align-items-center">
          <i class="fa-solid fa-cart-plus me-2 fs-5"></i>
          <span>Igračka je dodata u korpu!</span>
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Zatvori"></button>
      </div>
    </div>
  </div>
</div>

<!-- Loading prikaz -->
<ng-template #loadingTpl>
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="text-muted mt-3">Učitavanje detalja...</p>
  </div>
</ng-template>
